# klogproc

An utility for processing logs generated by KonText and other CNC applications.
It basically converts one JSON object into other. The format of the latter is
defined in a way so it can be used accross all the public web applications of CNC.
Output attributes are defined to make search/analytics easier.

## Overview

The program supports two kinds of log sources:

1. a Redis queue containing JSON-encoded logs to be processed
1. a directory containing KonText application logs (this is a legacy solution)

Expected format:

```json
 {
 "user_id": 1,
 "proc_time": 7.2016,
 "settings": {},
 "pid": 334,
 "request": {
    "HTTP_USER_AGENT": "...",
    "REMOTE_ADDR": "..."
 },
 "action": "...",
 "params": {
    "queryselector": "...",
    "corpname": "...",
    "/*... possibly other items ... */": "..."
 },
 "user": "...",
 "date": "..."
}
```

## Supported apps

* KonText - out of the box (just enable *ucnk_dispatch_hook* plug-in)
* SkE - the application must import a special Python module which is part of this project

## Installation

Compile the program and copy the binary to a desired location (e.g. */usr/local/bin*).
Set a cron job to fetch data from logs to ElasticSearch (here every 5 minutes):

```
*/5 * * * * /usr/local/bin/klogproc proclogs /opt/klogproc/ske.json
```